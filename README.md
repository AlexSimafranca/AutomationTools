# AutomationTools
A package of tools for automating GIWAXS processing using the WAXSTools package in Igor Pro.

Contents:
1. [Installation Instructions](#installation-instructions)
2. [Dependencies](#dependencies)
3. [Operations](#operations)
   - [Auto-Calibration](#auto-calibration)
   - [Data Importing (Single File / Batch Processing)](#data-importing-single-file--batch-processing)
   - [Data Selection Using WAXSTools](#data-selection-using-waxstools)
   - [Data Processing (Single File / Batch Processing)](#data-processing-single-file--batch-processing)
   - [Data Plotting](#data-plotting)
     - [2D GIWAXS Pattern Plot](#2d-giwaxs-pattern-plot)
     - [1D Integrated Line Plots](#1d-integrated-line-plots)
     - [1D Plot Parameter Customization](#1d-plot-parameter-customization)
   - [Data Arithmetic](#data-arithmetic)
     - [Addition / Subtraction](#addition--subtraction)
     - [Averaging](#averaging)
   - [Data Normalization](#data-normalization)
     - [Normalization Without Baseline Subtraction](#normalization-without-baseline-subtraction)
     - [Normalization With Constant Baseline Subtraction](#normalization-with-constant-baseline-subtraction)
   - [Data Masking](#data-masking)
4. [Authors](#authors)

## Installation Instructions
To install the package, follow these steps:

1. Locate the Igor Pro program folder (it should be under "Applications" or "Programs").
2. Within the Igor Pro program folder, transfer the following files:
   - The **"AutomationTools"** folder goes in the "User Procedures" folder.
   - The **"BootAutomationTools.ipf"** file goes in the "Igor Procedures" folder.

## Dependencies
This package was designed to run on Igor Pro v8.04 and relies on the [**Nika**](https://usaxs.xray.aps.anl.gov/software/nika) and **WAXSTools** (written by Stefan Oosterhout while at SSRL) packages. I do not own the right to distribute these dependencies, so please request them from their respective authors.

## Operations
AutomationTools performs a number of operations that improve the efficiency of your GIWAXS data processing workflow.

### Auto-Calibration
AutomationTools performs calibration through the Nika Beam Center and Calibration panel. To calibrate a LaB6 sample, perform the following steps:

1. Open the required calibration panels by clicking AutomationTools > Calibration > Open Calibration Panels.
2. Set initial calibration values through the WAXSTools panel. Initial values corresponding to SSRL beamline 11-3 are set by default when the WAXSTools panel is opened through the Open Calibration Panels option. When changing the initial values, click "Send to Nika" on the "raw to qz(qxy)" tab of the WAXSTools panel before proceeding with calibration.
3. Select a LaB6 .tif file by clicking AutomationTools > Calibration > Load LaB6 Calibration File. Use the pop-up navigation window to locate the LaB6 data file.
4. On the LaB6 diffraction image generated by Nika, drag the "A" cursor from the bottom left tool bar and place it near the beam spot position. Click "Read Cursor A" on the "Beam Cntr" tab of the Nika Beam Center and Calibration Panel, then click "Display circle?" and adjust the circle radius in comparison to the LaB6 diffraction rings using the slider bar to confirm you are near the beamspot position.
5. Once in an approximately correct position, click AutomationTools > Calibration > LaB6 Auto-Calibration to begin the calibration routine. Calibration values are automatically transfered to the WAXSTools panel upon completion of the calibration routine.
6. Select "Save calib" on the "raw to qz(qxy)" tab of the WAXSTools panel to save the calibration values to file, if desired. The LaB6 diffraction image and Nika Beam Center and Calibration panel can now be closed.

### Data Importing (Single File / Batch Processing)
Data can be batch imported using the "Load Images From Folder" command under AutomationTools > DataProcessing. Each data file will be automatically imported in its own folder for convenient organization.

Once the desired .tif data files are selected, you are given the option to truncate the data names for ease of processing via a pop-up box. The value entered into the pop-up text field should be the **first unique characters of the name section to be removed**. 

For example, if two data files are named "Sample1_250402.tif" and "Sample2_250402.tif", entering "_2" in the pop-up box will import the data as waves named "Sample1" and "Sample2".

### Data Selection Using WAXSTools
Selecting data for processing or plotting should be done through the WAXSTools panel. 

To display data in the WAXSTools panel, locate the desired data folder in the Data Browser window (Data > Data Browser), right click the folder and select "Set as Data Folder". Then, click "Read data folder" at the top of the WAXSTools panel.

### Data Processing (Single File / Batch Processing)
AutomationTools supports automated reduction of 2D GIWAXS images to 1D I-vs-Q and I-vs-Chi data. Note that only the data waves highlighted in the data window of the WAXSTools panel will be processed.

For reduction to I-vs-Q data:
1. Select one or more desired data waves by clicking their names in the WAXSTools panel data window.
2. Click AutomationTools > Data Processing > Process Images to I-vs-Q Data.

For reduction to I-vs-Chi data:
1. Select one or more desired data waves by clicking their names in the WAXSTools panel data window.
2. Set the desired ranges for chi and q through the "qz(qxy) to chi(q)" tab of the WAXSTools panel. Click "show cakeslice" to help with range selection.
3. Click AutomationTools > Data Processing > Process Images to I-vs-Chi Data.

### Data Plotting
Data plotting tools for the quick generation of formatted 2D GIWAXS patterns and 1D I-vs-Q and I-vs-Chi patterns are included.

#### 2D GIWAXS Pattern Plot
For easy reproduction of a formatted 2D qz-qxy GIWAXS patterns, select one or more data waves with a "_qzqxy" suffix in the WAXSTools panel data window and click AutomationTools > Plotting > 2D > Plot Formatted qz-qxy Image.

#### 1D Integrated Line Plots
For quick co-plotting of I-vs-Q patterns, select one or more data waves with the "_IvsQ" suffix in the WAXSTools panel data window and click AutomationTools > Plotting > 1D > Co-Plot Selected I-vs-Q Data. 

For quick co-plotting of I-vs-Chi patterns, select one or more data waves with the "_IvsChi" suffix in the WAXSTools panel data window and click AutomationTools > Plotting > 1D > Co-Plot Selected I-vs-Chi Data.

#### 1D Plot Parameter Customization
Default plot parameters for 1D I-vs-Q and I-vs-Chi plots are set using values contained in two files: **"AT_plotParameters.csv"** and **"AT_plotColors.csv"**. These files are located in the "AutomationTools" folder contained in the package. 

To permanently set your own default plot parameters, update these files directly. 

To set them temporarily, create your own CSV files and use the "Load Custom Plot Parameters" and "Load Custom Plot Colors" commands in the AutomationTools dropdown menu under Plotting > Plot Parameters.

Plots can be made **resizeable by default by setting either "width" or "height" or both to 0** in the "AT_plotParameters.csv" file.

### Data Arithmetic
AutomationTools supports data comparison through data arithmetic (addition, subtraction, averaging). Data arithmetic operations can be carried out either on the raw .tiff data files or on 1D integrated I-vs-Q or I-vs-Chi patterns. Be sure that the desired data waves are meaningfully comparable on a point-by-point basis before performing these operations.

#### Addition / Subtraction
To add or subtract data waves together, select the desired waves in the WAXTools panel data window and click AutomationTools > Data Manipulation > Data Arithmetic > Sum Selected Waves\Images for addition or AutomationTools > Data Manipulation > Data Arithmetic > Subtract Selected Waves\Images for subtraction.

#### Averaging
To average data waves, select the desired waves in the WAXTools panel data window and click AutomationTools > Data Manipulation > Data Arithmetic > Average Selected Waves\Images. This is a particularly useful feature when processing duplicate images of the same sample or images of duplicate samples made under the same conditions.

### Data Normalization
Normalization of 1D I-vs-Q or I-vs-Chi data is supported with or without constant baseline subtraction.

#### Normalization Without Baseline Subtraction
To normalize 1D data without baseline subtraction, select one or more data waves in the WAXSTools data window and click AutomationTools > Data Manipulation > Wave Normalization > Normalize Selected Waves to Max Value.

#### Normalization With Constant Baseline Subtraction
Normalization with constant baseline subtraction allows setting the minimum and maximum values between which the normalized and baseline-subtracted data should like. This is most useful when plotting data with a log-scale Y-axis because setting an arbitrarily non-zero minimum value (typically a power of 10) can suppress the appearance of noise within the data.

To normalize 1D data with baseline subtraction, select one or more data waves in the WAXSTools data window and click AutomationTools > Data Manipulation > Wave Normalization > Normalize Selected Waves to Max Value w\ Constant Baseline. A pop-up window will appear requesting the bounds of the data (R1, R2) to be considered as a flat baseline and the new minimum (C) and maximum (M) values between which the normalized data should lie in the format "R1, R2, C, M".

For example, entering "1.9, 1.95, 10, 1000" will produce normalized data with a minimum value of 10 in the range (1.9, 1.95) and an overall maximum value of 1000.

### Data Masking
Data masking removes the values for a specified plot range, leaving a gap in the plotted data. This can be used for removing irrelevant data such as contaminant peaks or detector aberrations.

To mask data over a specified range, select one or more data waves in the WAXSTools data window and click AutomationTools > Data Masking > Mask Data Points in Specified Range. In the pop-up window, enter the range of data to be removed (R1, R2) in the format "R1, R2".

## Authors

Creator and maintainer: Alexander Simafranca alesimaf@g.ucla.edu
